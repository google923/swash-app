<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0078d7" />
  <title>Email Settings - Swash Subscriber</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./assets/favicon-192.png" type="image/png" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    .admin-only, .rep-only, .admin-rep { display: none !important; }
    .subscriber-only { display: block !important; }
    .settings-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:16px; }
    .settings-grid label { display:flex; flex-direction:column; gap:6px; font-weight:600; color:#0f172a; }
    .settings-grid input[type="text"],
    .settings-grid input[type="number"],
    .settings-grid input[type="email"],
    .settings-grid input[type="password"] { padding:10px 12px; border:1px solid #cbd5e1; border-radius:8px; font-weight:400; }
    .toggle-row { display:flex; align-items:center; gap:10px; padding:10px 0; }
    .card-note { background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:16px; color:#334155; }
    .status-badge { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600; }
    .status-ok { background:#dcfce7; color:#166534; }
    .status-error { background:#fee2e2; color:#991b1b; }
    .status-pending { background:#fef9c3; color:#92400e; }
    .help-link { color:#0078d7; text-decoration:none; font-weight:600; }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-left">
      <img class="header-logo" src="./assets/swash-icon-white.png" alt="Swash logo" />
      <h1 style="margin:0 0 0 12px;font-size:1.2rem;">âœ‰ï¸ Email Settings</h1>
    </div>
    <div class="header-actions">
      <button id="logoutBtn" class="btn btn-secondary" type="button">Sign out</button>
      <div class="menu-box">
        <button id="menuBtn" class="btn btn-secondary" aria-haspopup="true" aria-expanded="false">Menu</button>
        <nav id="menuDropdown" class="dropdown">
          <div class="dropdown-title">Navigation</div>
          <a href="/admin/dashboard.html" class="admin-only">ğŸ  Admin Overview</a>
          <a href="/pipeline.html" class="admin-only">ğŸ“‹ New Customer Pipeline</a>
          <a href="/rep/add-new-customer.html" class="admin-rep-subscriber">ğŸ†• New Quote</a>
          <a href="/admin/subscribers.html" class="admin-only">ğŸ¢ Subscribers</a>
          <a href="/admin/users.html" class="admin-only">ğŸ‘¥ Manage Users</a>
          <a href="/admin/stats.html" class="admin-only">ğŸ“Š Stats</a>
          <a href="/admin-tracking.html" class="admin-only">ğŸ›°ï¸ Rep Tracking</a>
          <a href="/admin/shifts-logs.html" class="admin-only">ğŸ“‹ Shifts &amp; Logs</a>
          <a href="/admin/message-log.html" class="admin-only">ğŸ“§ Message Log</a>
          <a href="/rep/rep-home.html" class="rep-only">ğŸ  Rep Home</a>
          <a href="/subscriber-dashboard.html" class="subscriber-only">ğŸ  Dashboard</a>
          <a href="/rep/add-new-customer.html" class="subscriber-only">ğŸ†• New Quote</a>
          <a href="/pipeline.html" class="subscriber-only">ğŸ“‹ Customer Pipeline</a>
          <a href="/schedule.html" class="subscriber-only">ğŸ“… Cleaning Rota</a>
          <a href="/map.html" class="subscriber-only">ğŸ—ºï¸ Territory Map</a>
          <a href="/subscriber-cleaners.html" class="subscriber-only">ğŸ‘· Cleaner Management</a>
          <a href="/subscriber-rep-dashboard.html" class="subscriber-only">ğŸ§¾ Rep Dashboard</a>
          <a href="/subscriber-rep-log.html" class="subscriber-only">ğŸ“ Rep Log</a>
          <a href="/subscriber-shifts-logs.html" class="subscriber-only">ğŸ“‹ Shifts &amp; Logs</a>
          <a href="/subscriber-performance.html" class="subscriber-only">ğŸ¯ Performance</a>
          <a href="/subscriber-sms-setup.html" class="subscriber-only">ğŸ“² SMS Centre</a>
          <a href="/subscriber-email-settings.html" class="subscriber-only">âœ‰ï¸ Email Settings</a>
          <a href="/subscriber-tracking.html" class="subscriber-only">ğŸ“ Live Tracking</a>
        </nav>
      </div>
    </div>
  </header>

  <section id="authOverlay" class="auth-overlay" aria-live="polite">
    <div class="auth-card">
      <h2>Checking authentication...</h2>
      <p class="text-muted">Please wait while we verify your account.</p>
    </div>
  </section>

  <main id="emailContent" class="page" style="display:none;">

    <section class="card">
      <header class="card-header">
        <div class="card-header-main">
          <h2>SMTP Connection</h2>
          <p class="text-muted">Connect your own email provider to send booking confirmations.</p>
        </div>
        <div id="statusBadge"></div>
      </header>
      <div class="card-body" style="display:flex; flex-direction:column; gap:20px;">
        <div class="card-note">
          <strong>Need help?</strong> Follow the <a href="/subscriber-help/email-setup.html" class="help-link">email setup guide</a> for Gmail, Yahoo, and Outlook instructions.
        </div>
        <form id="settingsForm" class="form" autocomplete="off" spellcheck="false">
          <div class="settings-grid">
            <label>
              <span>SMTP Host</span>
              <input id="smtpHost" type="text" placeholder="smtp.gmail.com" required />
            </label>
            <label>
              <span>SMTP Port</span>
              <input id="smtpPort" type="number" min="1" max="65535" placeholder="465" required />
            </label>
            <label>
              <span>From Name</span>
              <input id="fromName" type="text" placeholder="Swash Cleaning" />
            </label>
            <label>
              <span>From Email</span>
              <input id="fromEmail" type="email" placeholder="you@company.com" required />
            </label>
            <label>
              <span>SMTP Username</span>
              <input id="smtpUsername" type="text" placeholder="your email address" />
            </label>
            <label>
              <span>SMTP Password</span>
              <input id="smtpPassword" type="password" placeholder="App password" autocomplete="new-password" />
            </label>
            <label>
              <span>Minimum minutes between emails</span>
              <input id="minSend" type="number" min="0" max="1440" value="0" />
            </label>
          </div>

          <div class="toggle-row">
            <input id="requireAuth" type="checkbox" checked />
            <label for="requireAuth" style="margin:0;font-weight:500;">My SMTP server requires authentication</label>
          </div>
          <div class="toggle-row">
            <input id="useStartTls" type="checkbox" />
            <label for="useStartTls" style="margin:0;font-weight:500;">Enable STARTTLS (recommended for ports 587/25)</label>
          </div>

          <div style="display:flex; gap:10px; align-items:center;">
            <button type="submit" class="btn btn-primary" id="saveBtn">Save settings</button>
            <span id="saveStatus" style="font-size:14px;color:#64748b;"></span>
          </div>
          <p id="passwordHint" style="font-size:13px;color:#64748b;margin-top:4px;"></p>
        </form>
      </div>
    </section>

    <section class="card" style="margin-top:24px;">
      <header class="card-header">
        <div class="card-header-main">
          <h2>Send Test Email</h2>
          <p class="text-muted">Verify your settings by sending a test message.</p>
        </div>
      </header>
      <div class="card-body">
        <form id="testForm" class="form" autocomplete="off" spellcheck="false">
          <div class="settings-grid">
            <label>
              <span>Recipient</span>
              <input id="testRecipient" type="email" placeholder="test@yourdomain.com" required />
            </label>
            <label>
              <span>Subject</span>
              <input id="testSubject" type="text" placeholder="Test email from Swash" required />
            </label>
          </div>
          <label style="display:flex;flex-direction:column;gap:6px;font-weight:600;color:#0f172a;margin-top:16px;">
            <span>Message</span>
            <textarea id="testMessage" rows="4" style="padding:10px 12px;border:1px solid #cbd5e1;border-radius:8px;font-family:inherit;resize:vertical;" placeholder="Hello! This is a test email from Swash."></textarea>
          </label>
          <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
            <button type="submit" class="btn btn-secondary" id="sendTestBtn">Send test email</button>
            <span id="testStatus" style="font-size:14px;color:#64748b;"></span>
          </div>
        </form>
      </div>
    </section>

    <section class="card" style="margin-top:24px;">
      <header class="card-header">
        <div class="card-header-main">
          <h2>Recent Email Activity</h2>
          <p class="text-muted">Track the last few messages sent from your account.</p>
        </div>
      </header>
      <div id="logsContainer" class="card-body" style="min-height:120px;">
        <p style="color:#64748b;">Loading activity...</p>
      </div>
    </section>

  </main>

  <script type="module" src="./subscriber-email-settings.js"></script>
</body>
</html>
