<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0078d7" />
  <title>Settings - Swash</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./assets/favicon-192.png" type="image/png" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    .settings-container { max-width:900px; margin:40px auto; }
    .settings-tabs { display:flex; gap:0; background:#0078d7; border-bottom:none; margin-bottom:24px; }
    .settings-tab { background:none; border:none; color:#fff; padding:12px 20px; font-weight:600; font-size:0.95rem; cursor:pointer; position:relative; transition:all 0.2s; opacity:0.8; }
    .settings-tab:hover { opacity:0.95; }
    .settings-tab.active { opacity:1; background:rgba(255,255,255,0.2); }
    .settings-panel { display:none; }
    .settings-panel.active { display:block; }
    .settings-section { background:#fff; border:1px solid #e2e8f0; border-radius:8px; padding:24px; margin-bottom:20px; }
    .settings-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    .settings-field { display:flex; flex-direction:column; gap:8px; }
    .settings-field label { font-weight:600; color:#0f172a; font-size:0.9rem; }
    .settings-field input, .settings-field select, .settings-field textarea { padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem; }
    .settings-field input:focus, .settings-field select:focus, .settings-field textarea:focus { outline:none; border-color:#0078d7; box-shadow:0 0 0 3px rgba(0,120,215,0.1); }
    .color-input-group { display:flex; gap:12px; align-items:flex-end; }
    .color-input-group input[type="color"] { width:60px; height:40px; border:1px solid #cbd5e1; border-radius:6px; cursor:pointer; }
    .color-preview { display:inline-block; width:20px; height:20px; border-radius:4px; border:1px solid #cbd5e1; vertical-align:middle; }
    .logo-upload-group { display:flex; gap:12px; align-items:flex-start; }
    .logo-preview { width:80px; height:80px; border:2px dashed #cbd5e1; border-radius:6px; display:flex; align-items:center; justify-content:center; background:#ffffff; }
    .logo-preview img { max-width:100%; max-height:100%; object-fit:contain; }
    .settings-actions { display:flex; gap:12px; justify-content:flex-end; margin-top:24px; }
    .btn-save { background:#0078d7; color:#fff; border:none; padding:10px 20px; border-radius:6px; font-weight:600; cursor:pointer; transition:background 0.2s; }
    .btn-save:hover { background:#005a9e; }
    .btn-reset { background:#e2e8f0; color:#0f172a; border:none; padding:10px 20px; border-radius:6px; font-weight:600; cursor:pointer; transition:background 0.2s; }
    .btn-reset:hover { background:#cbd5e1; }
    .info-text { font-size:0.85rem; color:#64748b; margin-top:4px; }
    .card-note { background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:16px; color:#334155; }
    .cleaner-card { background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; transition: all 0.2s; }
    .cleaner-card:hover { border-color: #0078d7; box-shadow: 0 4px 12px rgba(0,120,215,0.15); }
    .cleaner-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
    .cleaner-name { font-size: 1.2rem; font-weight: 600; color: #1e293b; }
    .cleaner-badge { padding: 4px 12px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; }
    .badge-active { background: #dcfce7; color: #166534; }
    .badge-inactive { background: #fee2e2; color: #991b1b; }
    .cleaner-info { margin-bottom: 16px; }
    .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
    .info-label { color: #64748b; font-size: 0.9rem; }
    .info-value { color: #1e293b; font-weight: 600; font-size: 0.9rem; }
    .cleaner-actions { display: flex; gap: 8px; }
    .package-card { border:2px solid #e2e8f0; border-radius:12px; padding:20px; background:#fff; display:flex; flex-direction:column; gap:12px; transition:border-color 0.2s, box-shadow 0.2s, transform 0.2s; }
    .package-card:hover { border-color:#0078d7; box-shadow:0 10px 25px rgba(0,120,215,0.12); transform:translateY(-2px); }
    .package-meta { font-size:0.9rem; color:#64748b; }
    .history-item { border:1px solid #e2e8f0; border-radius:10px; padding:14px 16px; background:#f8fafc; display:flex; flex-direction:column; gap:6px; }
    .history-item strong { color:#0f172a; }
    .history-status { font-weight:600; font-size:0.85rem; padding:4px 8px; border-radius:999px; display:inline-flex; align-items:center; gap:6px; }
    .history-status[data-status="pending"] { background:#fef9c3; color:#92400e; }
    .history-status[data-status="completed"] { background:#dcfce7; color:#166534; }
    .history-status[data-status="failed"] { background:#fee2e2; color:#991b1b; }
    .notice { padding:12px 14px; background:#f0fdf4; border:1px solid #86efac; border-radius:8px; font-size:0.95rem; color:#166534; margin-top:12px; }
    .error { padding:12px 14px; background:#fee2e2; border:1px solid #fca5a5; border-radius:8px; font-size:0.95rem; color:#991b1b; margin-top:12px; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
    .modal.show { display: flex; }
    .modal-content { background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-header h3 { margin: 0; font-size: 1.3rem; color: #1e293b; }
    .modal-close { background: none; border: none; font-size: 1.8rem; color: #64748b; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; }
    .modal-close:hover { background: #f1f5f9; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-weight: 600; color: #334155; margin-bottom: 8px; font-size: 0.95rem; }
    .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; transition: border-color 0.2s; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #0078d7; box-shadow: 0 0 0 3px rgba(0,120,215,0.1); }
    .modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; }
    @media (max-width: 640px) {
      .settings-grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>

  <section id="authOverlay" class="auth-overlay" aria-live="polite">
    <div class="auth-card">
      <h2>Checking authentication...</h2>
      <p class="text-muted">Please wait while we verify your account.</p>
    </div>
  </section>

  <main id="mainContent" class="page" style="display:none;">
    <div class="settings-container">
      <h1 style="margin-bottom:24px; color:#0f172a;">Settings</h1>
      
      <div class="settings-tabs">
        <button class="settings-tab active" data-tab="quote-form">Quote Form</button>
        <button class="settings-tab" data-tab="email">Email Settings</button>
        <button class="settings-tab" data-tab="sms">SMS Centre</button>
        <button class="settings-tab" data-tab="cleaners">Cleaners</button>
        <button class="settings-tab" data-tab="reps">Reps</button>
        <button class="settings-tab" data-tab="billing">Billing</button>
        <button class="settings-tab" data-tab="theme">Theme Settings</button>
      </div>

      <!-- Quote Form Settings - COMPLETE PRICING CONFIGURATION -->
      <div class="settings-panel active" data-panel="quote-form">
        <div class="settings-section">
          <h2 style="margin-bottom:8px; color:#0f172a;">Quote Form Configuration</h2>
          <p class="text-muted" style="margin-bottom:20px;">Complete pricing, branding, and quote form customization. All changes go live immediately.</p>
          
          <div style="display:flex; gap:12px; margin-bottom:20px; border-bottom:2px solid #e2e8f0; padding-bottom:12px; overflow-x:auto;">
            <button class="preview-tab-btn active" data-tab="form-text" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#0078d7; border-bottom:3px solid #0078d7; margin-bottom:-14px; white-space:nowrap;">Form Text</button>
            <button class="preview-tab-btn" data-tab="form-fields" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Form Fields</button>
            <button class="preview-tab-btn" data-tab="branding" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Branding</button>
            <button class="preview-tab-btn" data-tab="pricing-base" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Base Pricing</button>
            <button class="preview-tab-btn" data-tab="pricing-extras" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Extras & Modifiers</button>
            <button class="preview-tab-btn" data-tab="tiers" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Service Tiers</button>
            <button class="preview-tab-btn" data-tab="preview" style="padding:10px 16px; border:none; background:transparent; cursor:pointer; font-weight:600; color:#64748b; border-bottom:3px solid transparent; margin-bottom:-14px; white-space:nowrap;">Live Preview</button>
          </div>

          <!-- Form Text Tab -->
          <div id="tab-form-text" class="quote-tab" style="display:block;">
            <div style="display:grid; gap:20px;">
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="quoteFormTitle">Form Title</label>
                <input type="text" id="quoteFormTitle" placeholder="e.g. Get Your Quote" />
                <span class="info-text">Main heading on the quote form</span>
              </div>
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="quoteFormSubtitle">Form Subtitle</label>
                <input type="text" id="quoteFormSubtitle" placeholder="e.g. Fast & Free Quote" />
                <span class="info-text">Secondary text below title</span>
              </div>
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="quoteFormDescription">Form Description</label>
                <textarea id="quoteFormDescription" rows="3" placeholder="Describe the quote process..."></textarea>
                <span class="info-text">Instructions or details for customers</span>
              </div>
            </div>
          </div>

          <!-- Form Fields Tab -->
          <div id="tab-form-fields" class="quote-tab" style="display:none;">
            <div style="display:grid; gap:24px;">
              <div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:8px; padding:12px; color:#92400e; font-size:0.9rem;">
                <strong>Tip:</strong> Enable/disable fields shown on your public quote form. Mark fields as required or optional.
              </div>

              <div>
                <h3 style="margin:0 0 16px 0; font-weight:600; color:#0f172a;">Customer Details</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledCustomerName" checked />
                    <span>Customer Name</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredCustomerName" checked />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledEmail" checked />
                    <span>Email</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredEmail" checked />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledMobile" checked />
                    <span>Mobile</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredMobile" checked />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledAddress" checked />
                    <span>Address</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredAddress" checked />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledPostcode" />
                    <span>Postcode</span>
                  </label>
                  <div></div>
                </div>
              </div>

              <div>
                <h3 style="margin:0 0 16px 0; font-weight:600; color:#0f172a;">Property Details</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledHouseSize" checked />
                    <span>House Size</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredHouseSize" />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledHouseType" checked />
                    <span>House Type</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldRequiredHouseType" />
                    <span>Required</span>
                  </label>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledConservatory" checked />
                    <span>Conservatory</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledExtension" checked />
                    <span>Extension</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledRoofLanterns" checked />
                    <span>Roof Lanterns</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledSkylights" checked />
                    <span>Skylights</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledAlternating" />
                    <span>Alternating Sides</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledFrontOnly" />
                    <span>Front Only</span>
                  </label>
                  <div></div>
                </div>
              </div>

              <div>
                <h3 style="margin:0 0 16px 0; font-weight:600; color:#0f172a;">Additional Fields</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledNotes" checked />
                    <span>Notes / Comments</span>
                  </label>
                  <div></div>
                  <label class="checkbox" style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="fieldEnabledBookingDate" checked />
                    <span>Booking Date Picker</span>
                  </label>
                  <div style="color:#64748b; font-size:0.85rem;"><em>Note: Only shows if you have service areas assigned</em></div>
                </div>
              </div>

              <div>
                <button type="button" id="saveFieldConfigBtn" class="btn btn-primary" style="width:100%; max-width:200px;">Save Form Fields Configuration</button>
              </div>
            </div>
          </div>

          <!-- Branding Tab -->
          <div id="tab-branding" class="quote-tab" style="display:none;">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px; min-height:600px;">
              
              <!-- Live Preview on Left -->
              <div style="border:2px solid #e2e8f0; border-radius:8px; padding:20px; background:#f8fafc; position:relative; overflow:auto;">
                <div style="position:sticky; top:0; background:#f8fafc; padding-bottom:12px; border-bottom:1px solid #e2e8f0; margin-bottom:12px; z-index:10;">
                  <h3 style="margin:0; font-size:0.95rem; font-weight:600; color:#0f172a;">Live Preview</h3>
                  <p style="margin:4px 0 0 0; font-size:0.85rem; color:#64748b;">Click any element to customize</p>
                </div>
                
                <div id="brandingPreview" style="background:var(--preview-bg, white); border-radius:8px; padding:24px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                  <div style="text-align:center; margin-bottom:24px;">
                    <img id="previewLogo" src="./assets/logo.png" alt="Logo" style="max-width:100px; height:auto; margin-bottom:16px; cursor:pointer; border-radius:4px;" title="Click to change logo" />
                    <h1 id="previewTitle" style="margin:0 0 8px 0; font-size:1.8rem; font-weight:700; color:#0f172a; cursor:pointer;" title="Click to change title">Get Your Quote</h1>
                    <p id="previewSubtitle" style="margin:0; font-size:1rem; color:#64748b; cursor:pointer;" title="Click to change subtitle">Fast & Easy</p>
                  </div>

                  <div style="background:white; border-radius:6px; padding:16px; margin-bottom:16px; border:1px solid #e2e8f0;">
                    <div style="margin-bottom:12px;">
                      <label style="display:block; font-size:0.85rem; font-weight:600; color:#0f172a; margin-bottom:6px; cursor:pointer;" title="Click to customize" onclick="openCustomizeModal(event, 'houseSize')">House Size</label>
                      <select style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:4px; font-size:0.9rem; cursor:pointer;">
                        <option>3 bed</option>
                      </select>
                    </div>
                    <div>
                      <label style="display:block; font-size:0.85rem; font-weight:600; color:#0f172a; margin-bottom:6px; cursor:pointer;" title="Click to customize" onclick="openCustomizeModal(event, 'houseType')">House Type</label>
                      <select style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:4px; font-size:0.9rem; cursor:pointer;">
                        <option>Semi-Detached</option>
                      </select>
                    </div>
                  </div>

                  <div style="background:#f0f9ff; border:2px solid var(--preview-accent, #0ea5e9); border-radius:6px; padding:16px; text-align:center;">
                    <p style="margin:0 0 8px 0; font-size:0.85rem; text-transform:uppercase; font-weight:600; color:#475569; letter-spacing:0.5px;">Price per clean</p>
                    <p id="previewPrice" style="margin:0; font-size:2.5rem; font-weight:700; color:var(--preview-primary, #0078d7);">Â£24.00</p>
                    <p style="margin:4px 0 0 0; font-size:0.85rem; color:#64748b;">every 4 weeks</p>
                  </div>

                  <div style="margin-top:16px;">
                    <button id="previewSubmitBtn" type="button" style="width:100%; padding:12px; background:var(--preview-primary, #0078d7); color:var(--preview-btn-text, white); border:none; border-radius:6px; font-weight:600; font-size:0.95rem; cursor:pointer;" title="Click to change button">Get Quote</button>
                  </div>
                </div>
              </div>

              <!-- Customization Panel on Right -->
              <div id="customizationPanel" style="border:2px solid #e2e8f0; border-radius:8px; padding:20px; background:white; overflow-y:auto; display:none; flex-direction:column;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; border-bottom:2px solid #e2e8f0; padding-bottom:12px;">
                  <h3 id="customizePanelTitle" style="margin:0; font-weight:600; color:#0f172a;">Customize</h3>
                  <button type="button" id="closeCustomizeBtn" onclick="closeCustomizeModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#64748b;">âœ•</button>
                </div>

                <!-- Logo Upload -->
                <div id="logoCustomizeContent" style="display:none;">
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label>Logo Image</label>
                    <input type="file" id="logoUpload" accept="image/*" style="padding:8px; border:1px solid #cbd5e1; border-radius:4px; width:100%; font-size:0.9rem;" />
                    <span class="info-text">Upload your logo (PNG, JPG, SVG)</span>
                  </div>
                  <button type="button" onclick="updateLogoPreview()" style="width:100%; padding:8px; background:#0078d7; color:white; border:none; border-radius:4px; font-weight:600; cursor:pointer;">Update Logo</button>
                </div>

                <!-- Title & Subtitle -->
                <div id="textCustomizeContent" style="display:none;">
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label for="customizeTitle">Form Title</label>
                    <input type="text" id="customizeTitle" placeholder="Get Your Quote" style="padding:8px; border:1px solid #cbd5e1; border-radius:4px; width:100%; font-size:0.9rem;" onchange="updatePreview()" />
                  </div>
                  <div class="settings-field">
                    <label for="customizeSubtitle">Subtitle</label>
                    <input type="text" id="customizeSubtitle" placeholder="Fast & Easy" style="padding:8px; border:1px solid #cbd5e1; border-radius:4px; width:100%; font-size:0.9rem;" onchange="updatePreview()" />
                  </div>
                </div>

                <!-- Colors -->
                <div id="colorCustomizeContent" style="display:none;">
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label for="customizePrimaryColor">Primary Color (Buttons)</label>
                    <input type="color" id="customizePrimaryColor" value="#0078d7" style="width:100%; height:40px; border:1px solid #cbd5e1; border-radius:4px; cursor:pointer;" onchange="updatePreview()" />
                  </div>
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label for="customizeAccentColor">Accent Color (Highlights)</label>
                    <input type="color" id="customizeAccentColor" value="#0ea5e9" style="width:100%; height:40px; border:1px solid #cbd5e1; border-radius:4px; cursor:pointer;" onchange="updatePreview()" />
                  </div>
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label for="customizeBgColor">Background Color</label>
                    <input type="color" id="customizeBgColor" value="#ffffff" style="width:100%; height:40px; border:1px solid #cbd5e1; border-radius:4px; cursor:pointer;" onchange="updatePreview()" />
                  </div>
                  <div class="settings-field">
                    <label for="customizeButtonTextColor">Button Text Color</label>
                    <input type="color" id="customizeButtonTextColor" value="#ffffff" style="width:100%; height:40px; border:1px solid #cbd5e1; border-radius:4px; cursor:pointer;" onchange="updatePreview()" />
                  </div>
                </div>

                <!-- Button -->
                <div id="buttonCustomizeContent" style="display:none;">
                  <div class="settings-field" style="margin-bottom:12px;">
                    <label for="customizeButtonLabel">Button Text</label>
                    <input type="text" id="customizeButtonLabel" placeholder="Get Quote" style="padding:8px; border:1px solid #cbd5e1; border-radius:4px; width:100%; font-size:0.9rem;" onchange="updatePreview()" />
                  </div>
                  <div class="settings-field">
                    <label for="customizeCornerStyle">Button Style</label>
                    <select id="customizeCornerStyle" style="padding:8px; border:1px solid #cbd5e1; border-radius:4px; width:100%; font-size:0.9rem;" onchange="updatePreview()">
                      <option value="rounded">Rounded Corners</option>
                      <option value="pill">Pill-shaped</option>
                      <option value="square">Square</option>
                    </select>
                  </div>
                </div>
              </div>

            </div>

            <!-- Save Button -->
            <div style="margin-top:24px; padding-top:16px; border-top:1px solid #e2e8f0; display:flex; gap:12px;">
              <button type="button" id="saveBrandingBtn" class="btn btn-primary" style="flex:1;">Save Branding</button>
              <button type="button" onclick="resetBrandingPreview()" class="btn btn-secondary">Reset to Defaults</button>
            </div>
          </div>

          <!-- Base Pricing Tab -->
          <div id="tab-pricing-base" class="quote-tab" style="display:none;">
            <div style="display:grid; gap:16px;">
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                <div class="settings-field">
                  <label for="pricingMinimum">Minimum Clean Price (Â£)</label>
                  <input type="number" id="pricingMinimum" step="0.01" min="0" value="16" />
                  <span class="info-text">Floor price for any clean</span>
                </div>
                <div class="settings-field">
                  <label for="pricingVatIncluded">VAT Status</label>
                  <select id="pricingVatIncluded">
                    <option value="true" selected>Prices are VAT inclusive</option>
                    <option value="false">Prices are before VAT</option>
                  </select>
                  <span class="info-text">How prices appear to customers</span>
                </div>
              </div>

              <div style="border-top:1px solid #e2e8f0; padding-top:16px;">
                <h4 style="margin:0 0 12px 0; color:#0f172a; font-weight:600;">Base Prices by Property Size</h4>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px;">
                  <div class="settings-field">
                    <label for="price2bed">2 Bed (Â£)</label>
                    <input type="number" id="price2bed" step="0.01" min="0" value="21" />
                  </div>
                  <div class="settings-field">
                    <label for="price3bed">3 Bed (Â£)</label>
                    <input type="number" id="price3bed" step="0.01" min="0" value="24" />
                  </div>
                  <div class="settings-field">
                    <label for="price4bed">4 Bed (Â£)</label>
                    <input type="number" id="price4bed" step="0.01" min="0" value="28" />
                  </div>
                  <div class="settings-field">
                    <label for="price5bed">5 Bed (Â£)</label>
                    <input type="number" id="price5bed" step="0.01" min="0" value="32" />
                  </div>
                  <div class="settings-field">
                    <label for="price6bed">6 Bed (Â£)</label>
                    <input type="number" id="price6bed" step="0.01" min="0" value="36" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Extras Tab -->
          <div id="tab-pricing-extras" class="quote-tab" style="display:none;">
            <div style="display:grid; gap:16px;">
              <div>
                <h4 style="margin:0 0 12px 0; color:#0f172a; font-weight:600;">Add-on Charges</h4>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px;">
                  <div class="settings-field">
                    <label for="priceExtensionAdd">Extension Add-on (Â£)</label>
                    <input type="number" id="priceExtensionAdd" step="0.01" min="0" value="4" />
                    <span class="info-text">Extension or wrap-around</span>
                  </div>
                  <div class="settings-field">
                    <label for="priceConservatoryAdd">Conservatory Add-on (Â£)</label>
                    <input type="number" id="priceConservatoryAdd" step="0.01" min="0" value="6" />
                    <span class="info-text">Glass rooms</span>
                  </div>
                  <div class="settings-field">
                    <label for="priceRoofLanternEach">Roof Lantern Each (Â£)</label>
                    <input type="number" id="priceRoofLanternEach" step="0.01" min="0" value="10" />
                    <span class="info-text">Per lantern</span>
                  </div>
                  <div class="settings-field">
                    <label for="priceSkylightEach">Skylight Each (Â£)</label>
                    <input type="number" id="priceSkylightEach" step="0.01" min="0" value="1.50" />
                    <span class="info-text">Per skylight</span>
                  </div>
                </div>
              </div>

              <div style="border-top:1px solid #e2e8f0; padding-top:16px;">
                <h4 style="margin:0 0 12px 0; color:#0f172a; font-weight:600;">Property Modifiers</h4>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(160px, 1fr)); gap:12px;">
                  <div class="settings-field">
                    <label for="alternatingFactor">Alternating Factor</label>
                    <input type="number" id="alternatingFactor" step="0.01" min="0" max="1" value="0.5" />
                    <span class="info-text">Interior/exterior alternating</span>
                  </div>
                  <div class="settings-field">
                    <label for="frontOnlyFactor">Front-Only Factor</label>
                    <input type="number" id="frontOnlyFactor" step="0.01" min="0" max="1" value="0.6" />
                    <span class="info-text">Front only discount</span>
                  </div>
                </div>
              </div>

              <div style="border-top:1px solid #e2e8f0; padding-top:16px;">
                <h4 style="margin:0 0 12px 0; color:#0f172a; font-weight:600;">House Type Multipliers</h4>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px;">
                  <div class="settings-field">
                    <label for="mult_bungalow">Bungalow</label>
                    <input type="number" id="mult_bungalow" step="0.01" min="0" value="0.94" />
                  </div>
                  <div class="settings-field">
                    <label for="mult_maisonette">Maisonette</label>
                    <input type="number" id="mult_maisonette" step="0.01" min="0" value="0.96" />
                  </div>
                  <div class="settings-field">
                    <label for="mult_terrace">Terrace</label>
                    <input type="number" id="mult_terrace" step="0.01" min="0" value="1.00" />
                  </div>
                  <div class="settings-field">
                    <label for="mult_semidetached">Semi-Detached</label>
                    <input type="number" id="mult_semidetached" step="0.01" min="0" value="1.00" />
                  </div>
                  <div class="settings-field">
                    <label for="mult_detached">Detached</label>
                    <input type="number" id="mult_detached" step="0.01" min="0" value="1.08" />
                  </div>
                  <div class="settings-field">
                    <label for="mult_mobilehome">Mobile Home</label>
                    <input type="number" id="mult_mobilehome" step="0.01" min="0" value="0.90" />
                  </div>
                </div>
              </div>

              <div style="border-top:1px solid #e2e8f0; padding-top:16px;">
                <h4 style="margin:0 0 12px 0; color:#0f172a; font-weight:600;">Feature Toggles</h4>
                <div style="display:grid; gap:12px;">
                  <label style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="toggle_alternating" checked />
                    <span>Allow alternating clean option</span>
                  </label>
                  <label style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="toggle_frontonly" checked />
                    <span>Allow front-only pricing</span>
                  </label>
                  <label style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="toggle_offerbtn" checked />
                    <span>Show tier upgrade offer button</span>
                  </label>
                  <label style="display:flex; gap:8px; align-items:center;">
                    <input type="checkbox" id="toggle_notesfield" checked />
                    <span>Show notes field by default</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Service Tiers Tab -->
          <div id="tab-tiers" class="quote-tab" style="display:none;">
            <div style="display:grid; gap:16px;">
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                <div class="settings-field">
                  <label for="tierSilverLabel">Standard Tier Name</label>
                  <input type="text" id="tierSilverLabel" value="Silver" />
                </div>
                <div class="settings-field">
                  <label for="tierGoldLabel">Premium Tier Name</label>
                  <input type="text" id="tierGoldLabel" value="Gold" />
                </div>
              </div>
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="tierSilverDescription">Standard Tier Description</label>
                <textarea id="tierSilverDescription" rows="2" placeholder="Windows only, every 4 weeks."></textarea>
              </div>
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="tierGoldDescription">Premium Tier Description</label>
                <textarea id="tierGoldDescription" rows="2" placeholder="Frames, sills and reminders included."></textarea>
              </div>
              <div class="settings-field">
                <label for="tierGoldMultiplier">Premium Price Multiplier</label>
                <input type="number" id="tierGoldMultiplier" step="0.01" min="1" value="1.35" />
                <span class="info-text">Multiplier on standard prices (e.g., 1.35 = 35% more)</span>
              </div>
              <div class="settings-field" style="grid-column:1/-1;">
                <label for="tierOfferLabel">Offer Label</label>
                <input type="text" id="tierOfferLabel" value="Gold upgrade included" placeholder="Shown on upgrade button" />
                <span class="info-text">Displayed on the offer button</span>
              </div>
            </div>
          </div>

          <!-- Live Preview Tab -->
          <div id="tab-preview" class="quote-tab" style="display:none; max-height:calc(100vh - 250px); overflow-y:auto;">
            <div style="border:2px solid #0078d7; border-radius:12px; padding:24px; background:#f9fafb; max-width:600px; margin:0 auto;">
              <div style="text-align:center; margin-bottom:24px;">
                <div id="previewLogo" style="height:60px; margin-bottom:12px; display:flex; align-items:center; justify-content:center;">
                  <img src="" alt="Logo" style="max-height:60px; max-width:200px; display:none;" id="previewLogoImg" />
                </div>
                <h1 id="previewTitle" style="margin:0 0 8px 0; font-size:1.8rem; color:#0f172a; font-weight:700;">Get Your Quote</h1>
                <p id="previewSubtitle" style="margin:0 0 8px 0; font-size:1.1rem; color:#0078d7; font-weight:600;">Fast & Free Quote</p>
                <p id="previewDescription" style="margin:0; font-size:0.95rem; color:#64748b;">Get an instant personalized quote</p>
              </div>

              <form style="display:grid; gap:16px;">
                <div style="display:grid; gap:12px;">
                  <div>
                    <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">Customer Name</label>
                    <input type="text" placeholder="John Doe" style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;" />
                  </div>
                  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                    <div>
                      <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">Email</label>
                      <input type="email" placeholder="john@example.com" style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;" />
                    </div>
                    <div>
                      <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">Mobile</label>
                      <input type="tel" placeholder="07xxx xxxxxx" style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;" />
                    </div>
                  </div>
                  <div>
                    <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">Address</label>
                    <input type="text" placeholder="123 Main Street" style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;" />
                  </div>
                  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                    <div>
                      <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">Service Tier</label>
                      <select style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;" id="previewServiceTier">
                        <option value="silver">Silver</option>
                        <option value="gold" selected>Gold</option>
                      </select>
                    </div>
                    <div>
                      <label style="display:block; font-weight:600; color:#0f172a; margin-bottom:6px;">House Size</label>
                      <select style="width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.95rem;">
                        <option>2 bed</option>
                        <option selected>3 bed</option>
                        <option>4 bed</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;">
                  <button type="button" id="previewSuggestBtn" style="padding:12px; border:2px solid #0078d7; background:transparent; color:#0078d7; font-weight:600; border-radius:6px; cursor:pointer; transition:all 0.3s;">ðŸ’¡ Get Suggestions</button>
                  <button type="button" id="previewCalculateBtn" style="padding:12px; border:none; background:#0078d7; color:white; font-weight:600; border-radius:6px; cursor:pointer; transition:all 0.3s;">Calculate Quote</button>
                </div>

                <div id="previewResults" style="display:none; margin-top:16px; padding:16px; background:#f0fdf4; border:1px solid #86efac; border-radius:6px;">
                  <p style="margin:0; font-size:0.9rem; color:#166534;">
                    <strong>Upfront Price:</strong> Â£<span id="previewUpfrontPrice">0.00</span><br />
                    <strong>Price per clean:</strong> Â£<span id="previewPerCleanPrice">0.00</span> every 28 days
                  </p>
                </div>
              </form>
            </div>
          </div>

          <!-- Save Buttons -->
          <div class="settings-actions" style="margin-top:24px; position:sticky; bottom:0; background:white; padding:16px 0; border-top:1px solid #e2e8f0;">
            <button class="btn-reset" id="resetQuoteFormBtn">Reset to Defaults</button>
            <button class="btn-save" id="saveQuoteFormBtn">Save All Settings</button>
          </div>
        </div>
      </div>

      <!-- Email Settings -->
      <div class="settings-panel" data-panel="email">
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">SMTP Connection</h2>
          <p class="text-muted" style="margin-bottom:16px;">Connect your own email provider to send booking confirmations.</p>
          <div class="card-note" style="background:#f0fdf4; border:1px solid #86efac; border-radius:8px; padding:12px 14px; margin-bottom:16px; font-size:0.95rem; color:#166534;">
            <strong>Need help?</strong> Follow the email setup guide for Gmail, Yahoo, and Outlook instructions.
          </div>
          <div class="settings-grid">
            <div class="settings-field">
              <label for="smtpHost">SMTP Host</label>
              <input type="text" id="smtpHost" placeholder="smtp.gmail.com" required />
            </div>
            <div class="settings-field">
              <label for="smtpPort">SMTP Port</label>
              <input type="number" id="smtpPort" placeholder="465" min="1" max="65535" required />
            </div>
            <div class="settings-field">
              <label for="emailFromName">From Name</label>
              <input type="text" id="emailFromName" placeholder="Swash Cleaning" />
            </div>
            <div class="settings-field">
              <label for="emailAddress">From Email</label>
              <input type="email" id="emailAddress" placeholder="you@company.com" required />
            </div>
            <div class="settings-field">
              <label for="emailUsername">SMTP Username</label>
              <input type="text" id="emailUsername" placeholder="your email address" />
            </div>
            <div class="settings-field">
              <label for="emailPassword">SMTP Password</label>
              <input type="password" id="emailPassword" placeholder="App password" />
            </div>
            <div class="settings-field">
              <label for="minSend">Min minutes between emails</label>
              <input type="number" id="minSend" min="0" max="1440" value="0" />
            </div>
          </div>

          <div style="display:flex; flex-direction:column; gap:12px; margin-top:16px; margin-bottom:16px;">
            <label style="display:flex; gap:8px; align-items:center;">
              <input type="checkbox" id="requireAuth" checked />
              <span style="font-weight:500;">My SMTP server requires authentication</span>
            </label>
            <label style="display:flex; gap:8px; align-items:center;">
              <input type="checkbox" id="useStartTls" />
              <span style="font-weight:500;">Enable STARTTLS (recommended for ports 587/25)</span>
            </label>
          </div>

          <div class="settings-actions">
            <button class="btn-reset" id="resetEmailBtn">Reset</button>
            <button class="btn-save" id="saveEmailBtn">Save Settings</button>
          </div>
          <p id="passwordHint" style="font-size:13px;color:#64748b;margin-top:12px;"></p>
        </div>

        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">Send Test Email</h2>
          <p class="text-muted" style="margin-bottom:16px;">Verify your settings by sending a test message.</p>
          <form id="testForm" style="display:flex; flex-direction:column; gap:16px;">
            <div class="settings-grid">
              <div class="settings-field">
                <label for="testRecipient">Recipient</label>
                <input type="email" id="testRecipient" placeholder="test@yourdomain.com" required />
              </div>
              <div class="settings-field">
                <label for="testSubject">Subject</label>
                <input type="text" id="testSubject" placeholder="Test email from Swash" required />
              </div>
            </div>
            <div class="settings-field">
              <label for="testMessage">Message</label>
              <textarea id="testMessage" rows="4" style="padding:10px 12px;border:1px solid #cbd5e1;border-radius:8px;font-family:inherit;resize:vertical;" placeholder="Hello! This is a test email from Swash."></textarea>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
              <button type="submit" class="btn-save" id="sendTestBtn">Send test email</button>
              <span id="testStatus" style="font-size:14px;color:#64748b;"></span>
            </div>
          </form>
        </div>

        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">Recent Email Activity</h2>
          <p class="text-muted" style="margin-bottom:16px;">Track the last few messages sent from your account.</p>
          <div id="logsContainer" style="min-height:120px;">
            <p style="color:#64748b;">Loading activity...</p>
          </div>
        </div>
      </div>

      <!-- SMS Centre -->
      <div class="settings-panel" data-panel="sms">
        <!-- SMS Balance Section -->
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Your SMS Balance</h2>
          <p class="text-muted" style="margin-bottom:16px;">Manage your sender name, remaining credits, and top-ups.</p>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px;">
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <span style="font-size:0.9rem; color:#64748b;">Current credits</span>
              <span id="creditsBalance" style="font-size:2.6rem; font-weight:700; color:#0078d7;">0</span>
              <span style="font-size:0.9rem; color:#64748b;" id="lastTopUp">Last top-up: â€”</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <h3 style="margin:0; font-size:1.1rem; color:#1e293b;">Sender ID</h3>
              <p style="margin:0; color:#475569; font-size:0.95rem;">Set the name that appears on outgoing SMS messages (max 11 letters or numbers).</p>
              <form id="senderForm" autocomplete="off" spellcheck="false" style="display:flex; flex-direction:column; gap:12px;">
                <label style="display:flex; flex-direction:column; gap:6px; font-weight:600; color:#0f172a;">
                  <span>Sender name</span>
                  <input id="senderName" maxlength="11" placeholder="SWASHCLEAN" style="padding:10px 12px;border:1px solid #cbd5e1;border-radius:8px;font-weight:500;letter-spacing:1px;text-transform:uppercase;" />
                </label>
                <button type="submit" class="btn-save" id="saveSenderBtn">Save sender name</button>
                <p id="senderStatus" style="margin:0;font-size:0.85rem;color:#64748b;"></p>
              </form>
            </div>
          </div>
        </div>

        <!-- SMS Provider Configuration -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">SMS Provider Configuration</h2>
          <p class="text-muted" style="margin-bottom:16px;">Configure your SMS provider and API credentials.</p>
          <div style="display:grid; gap:20px;">
            <div class="settings-field">
              <label for="smsProvider">SMS Provider</label>
              <select id="smsProvider" style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;">
                <option value="twilio">Twilio</option>
                <option value="nexmo">Nexmo</option>
                <option value="aws">AWS SNS</option>
              </select>
              <span class="info-text">Choose your SMS provider</span>
            </div>
            <div class="settings-field">
              <label for="smsApiKey">API Key / Auth Token</label>
              <input type="password" id="smsApiKey" placeholder="Enter your API key" style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;" />
              <span class="info-text">Your SMS provider API credentials (securely stored)</span>
            </div>
          </div>
          <div class="settings-actions" style="margin-top:20px;">
            <button class="btn-save" id="saveSmsConfigBtn">Save Provider Settings</button>
          </div>
        </div>

        <!-- Buy SMS Credits Section -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">Buy SMS Credits</h2>
          <p class="text-muted" style="margin-bottom:16px;">Secure payment via GoCardless Instant Bank Pay. Credits are applied automatically after payment confirmation.</p>
          <div id="purchaseFeedback"></div>
          <div id="packagesContainer" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; margin-top:12px;"></div>
        </div>

        <!-- SMS Templates Section -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">SMS Message Templates</h2>
          <p class="text-muted" style="margin-bottom:16px;">Customize SMS messages sent to customers.</p>
          <div style="display:grid; gap:20px;">
            <div class="settings-field" style="grid-column:1/-1;">
              <label for="smsBookingTemplate">Booking Confirmation Template</label>
              <textarea id="smsBookingTemplate" rows="3" placeholder="Hi {customerName}, your quote {refCode} is confirmed. First clean: {date}. Reply STOP to opt out." style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;"></textarea>
              <span class="info-text">Available variables: {customerName}, {refCode}, {date}, {price}, {cleanerName}</span>
            </div>
            <div class="settings-field" style="grid-column:1/-1;">
              <label for="smsReminderTemplate">Reminder Template</label>
              <textarea id="smsReminderTemplate" rows="3" placeholder="Hi {customerName}, reminder: your clean is tomorrow. Our cleaner {cleanerName} will arrive between {timeWindow}." style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;"></textarea>
              <span class="info-text">Sent 24 hours before scheduled clean</span>
            </div>
            <div class="settings-field" style="grid-column:1/-1;">
              <label for="smsFollowUpTemplate">Follow-up Template</label>
              <textarea id="smsFollowUpTemplate" rows="3" placeholder="Thanks for booking with us! Rate your experience: {surveyLink}" style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;"></textarea>
              <span class="info-text">Sent after clean completion</span>
            </div>
          </div>
          <div class="settings-actions" style="margin-top:20px;">
            <button class="btn-save" id="saveSmsTemplatesBtn">Save Templates</button>
          </div>
        </div>

        <!-- SMS Scheduling & Delivery Settings -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">Scheduling & Delivery</h2>
          <p class="text-muted" style="margin-bottom:16px;">Control when and how SMS messages are sent.</p>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px;">
            <div class="settings-field">
              <label for="minSendMinutes">Minimum Time Between Messages (minutes)</label>
              <input type="number" id="minSendMinutes" min="0" max="1440" placeholder="5" style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;" />
              <span class="info-text">Avoid message spam to same customer</span>
            </div>
            <div class="settings-field">
              <label for="reminderHoursBefore">Send Reminder Hours Before Clean</label>
              <input type="number" id="reminderHoursBefore" min="1" max="72" placeholder="24" style="padding:10px 12px; border:1px solid #cbd5e1; border-radius:6px; font-size:0.9rem;" />
              <span class="info-text">Default: 24 hours before scheduled clean</span>
            </div>
            <div class="settings-field">
              <label style="display:flex; align-items:center; gap:8px; font-weight:600; color:#0f172a; cursor:pointer;">
                <input type="checkbox" id="smsOptInRequired" style="width:18px; height:18px; cursor:pointer;" />
                <span>Require opt-in for SMS marketing</span>
              </label>
              <span class="info-text">Only send promotional SMS if customer opted in</span>
            </div>
            <div class="settings-field">
              <label style="display:flex; align-items:center; gap:8px; font-weight:600; color:#0f172a; cursor:pointer;">
                <input type="checkbox" id="smsDeliveryNotifs" style="width:18px; height:18px; cursor:pointer;" />
                <span>Enable delivery notifications</span>
              </label>
              <span class="info-text">Get notified of SMS delivery status</span>
            </div>
          </div>
          <div class="settings-actions" style="margin-top:20px;">
            <button class="btn-save" id="saveSmsSchedulingBtn">Save Scheduling Settings</button>
          </div>
        </div>

        <!-- Purchase History Section -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">Purchase History</h2>
          <p class="text-muted" style="margin-bottom:16px;">Track recent top-ups and their status.</p>
          <div id="historyContainer" style="display:flex; flex-direction:column; gap:12px;"></div>
        </div>

        <!-- SMS Usage Statistics -->
        <div class="settings-section" style="margin-top:24px;">
          <h2 style="margin-bottom:16px; color:#0f172a;">SMS Usage Statistics</h2>
          <p class="text-muted" style="margin-bottom:16px;">Track your SMS usage and analytics.</p>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px;">
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:8px;">
              <span style="font-size:0.9rem; color:#64748b;">This Month</span>
              <span id="monthlyUsage" style="font-size:1.8rem; font-weight:700; color:#0078d7;">0</span>
              <span style="font-size:0.85rem; color:#64748b;">SMS sent</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:8px;">
              <span style="font-size:0.9rem; color:#64748b;">Total This Year</span>
              <span id="yearlyUsage" style="font-size:1.8rem; font-weight:700; color:#0078d7;">0</span>
              <span style="font-size:0.85rem; color:#64748b;">SMS sent</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:8px;">
              <span style="font-size:0.9rem; color:#64748b;">Success Rate</span>
              <span id="successRate" style="font-size:1.8rem; font-weight:700; color:#0078d7;">â€”</span>
              <span style="font-size:0.85rem; color:#64748b;">delivery rate</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Cleaners Settings -->
      <div class="settings-panel" data-panel="cleaners">
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Your Cleaners</h2>
          <p class="text-muted" style="margin-bottom:16px;">Manage your team and subscription billing</p>
          
          <div style="background: linear-gradient(135deg, #0078d7 0%, #005a9e 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h3 style="margin: 0 0 8px 0; font-size: 1.3rem;">ðŸ’¡ Pricing Information</h3>
              <p style="margin: 0; opacity: 0.9;">Each cleaner seat: Â£10/month</p>
              <p style="margin: 8px 0 0 0; opacity: 0.9;">First cleaner included in your base subscription</p>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 4px;" id="totalCost">Â£10.00</div>
              <div style="opacity: 0.9; font-size: 0.9rem;">per month</div>
            </div>
          </div>

          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
            <h3 style="margin:0; color:#0f172a;">Cleaners Grid</h3>
            <button class="btn-save" id="addCleanerBtn" style="background:#0078d7;">+ Add Cleaner</button>
          </div>

          <div class="cleaners-grid" id="cleanersGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="text-align:center;padding:40px;color:#64748b;grid-column:1/-1;">
              Loading cleaners...
            </div>
          </div>
        </div>
      </div>

      <!-- Reps Settings -->
      <div class="settings-panel" data-panel="reps">
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Your Reps</h2>
          <p class="text-muted" style="margin-bottom:16px;">Manage field reps and subscription billing</p>

          <div style="background: linear-gradient(135deg, #0078d7 0%, #005a9e 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h3 style="margin: 0 0 8px 0; font-size: 1.3rem;">ðŸ‘Ÿ Rep Pricing</h3>
              <p style="margin: 0; opacity: 0.9;">Each rep seat: Â£10/month</p>
              <p style="margin: 8px 0 0 0; opacity: 0.9;">First rep included in your base subscription</p>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 4px;" id="repsTotalCost">Â£10.00</div>
              <div style="opacity: 0.9; font-size: 0.9rem;">per month</div>
            </div>
          </div>

          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
            <h3 style="margin:0; color:#0f172a;">Reps Grid</h3>
            <button class="btn-save" id="addRepBtn" style="background:#0078d7;">+ Add Rep</button>
          </div>

          <div class="cleaners-grid" id="repsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="text-align:center;padding:40px;color:#64748b;grid-column:1/-1;">
              Loading reps...
            </div>
          </div>
        </div>
      </div>

      <!-- Billing Settings -->
      <div class="settings-panel" data-panel="billing">
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Billing Overview</h2>
          <p class="text-muted" style="margin-bottom:20px;">View your subscription, payment history, and invoice details</p>

          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; margin-bottom:24px;">
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <span style="font-size:0.9rem; color:#64748b;">Current Plan</span>
              <span style="font-size:1.4rem; font-weight:700; color:#0078d7;" id="billingPlanName">Loading...</span>
              <span style="font-size:0.85rem; color:#64748b;" id="billingPlanDetails">â€”</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <span style="font-size:0.9rem; color:#64748b;">Monthly Cost</span>
              <span style="font-size:1.4rem; font-weight:700; color:#0078d7;" id="billingMonthlyCost">Â£0.00</span>
              <span style="font-size:0.85rem; color:#64748b;">Base + cleaners/reps</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <span style="font-size:0.9rem; color:#64748b;">Next Payment Due</span>
              <span style="font-size:1.4rem; font-weight:700; color:#0078d7;" id="billingNextDueDate">â€”</span>
              <span style="font-size:0.85rem; color:#64748b;" id="billingDaysUntil">â€”</span>
            </div>
            <div style="border:1px solid #e2e8f0; border-radius:10px; padding:18px; background:#fff; display:flex; flex-direction:column; gap:12px;">
              <span style="font-size:0.9rem; color:#64748b;">Account Status</span>
              <span style="font-size:1.4rem; font-weight:700; color:#166534;" id="billingAccountStatus">Active</span>
              <span style="font-size:0.85rem; color:#64748b;">Paid and up to date</span>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Payment Method</h2>
          <p class="text-muted" style="margin-bottom:16px;">Your account payment information and mandate details</p>

          <div style="background:#f0fdf4; border:1px solid #86efac; border-radius:8px; padding:16px; margin-bottom:16px;">
            <div style="display:flex; justify-content:space-between; align-items:start; gap:16px;">
              <div>
                <h3 style="margin:0 0 8px; color:#0f172a; font-size:1rem;">ðŸ’³ Payment Details</h3>
                <div style="display:flex; flex-direction:column; gap:8px; color:#475569; font-size:0.95rem;">
                  <div><strong>Account Holder:</strong> <span id="billingAcctHolder">â€”</span></div>
                  <div><strong>Payment Method:</strong> <span id="billingPaymentMethod">GoCardless Bank Transfer</span></div>
                  <div><strong>Bank Account:</strong> <span id="billingBankAccount">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span></div>
                  <div><strong>Sort Code:</strong> <span id="billingSortCode">â€¢â€¢â€¢â€¢â€¢â€¢</span></div>
                  <div style="margin-top:8px;"><strong>Mandate Status:</strong> <span style="background:#dcfce7; color:#166534; padding:4px 8px; border-radius:4px; font-size:0.85rem; font-weight:600;" id="billingMandateStatus">Active</span></div>
                </div>
              </div>
              <button class="btn-save" id="updatePaymentBtn" style="background:#0078d7; height:fit-content;">Update Payment Method</button>
            </div>
          </div>

          <div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:8px; padding:12px 14px; font-size:0.9rem; color:#92400e;">
            <strong>ðŸ“ Mandate Information:</strong> Your GoCardless mandate allows us to collect payments on the billing date. You can cancel or modify it anytime from your GoCardless dashboard.
          </div>
        </div>

        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Billing History</h2>
          <p class="text-muted" style="margin-bottom:16px;">View all past invoices and payments</p>

          <div style="display:flex; flex-direction:column; gap:12px;" id="billingHistoryContainer">
            <div style="text-align:center; padding:40px; color:#64748b;">
              Loading payment history...
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Subscription Items</h2>
          <p class="text-muted" style="margin-bottom:16px;">Breakdown of your current billing items</p>

          <div style="display:grid; grid-template-columns:1fr; gap:12px;" id="subscriptionItemsContainer">
            <div style="text-align:center; padding:40px; color:#64748b;">
              Loading subscription details...
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Account Actions</h2>
          <p class="text-muted" style="margin-bottom:16px;">Manage your subscription</p>

          <div style="display:flex; gap:12px; flex-wrap:wrap;">
            <button class="btn-save" id="downloadInvoiceBtn" style="background:#0078d7;">ðŸ“¥ Download Invoice</button>
            <button class="btn-save" id="viewBillingPortalBtn" style="background:#0078d7;">ðŸ’³ Billing Portal</button>
            <button class="btn-reset" id="pauseSubscriptionBtn">â¸ï¸ Pause Subscription</button>
            <button class="btn-reset" id="cancelSubscriptionBtn" style="background:#fee2e2; color:#991b1b;">âŒ Cancel Subscription</button>
          </div>
        </div>
      </div>

      <!-- Theme Settings -->
      <div class="settings-panel" data-panel="theme">
        <div class="settings-section">
          <h2 style="margin-bottom:16px; color:#0f172a;">Theme Settings</h2>
          
          <h3 style="margin-top:20px; margin-bottom:12px; color:#0f172a; font-size:0.95rem;">Brand Logo</h3>
          <div class="logo-upload-group">
            <div style="flex:1;">
              <label for="companyLogoUpload" style="display:block; margin-bottom:8px; font-weight:600; color:#0f172a;">Upload Company Logo</label>
              <input type="file" id="companyLogoUpload" accept="image/*" style="padding:8px 12px; border:1px solid #cbd5e1; border-radius:6px; width:100%;" />
              <span class="info-text" style="display:block; margin-top:8px;">PNG, JPG, or GIF - max 2MB. Automatically compressed and stored securely.</span>
            </div>
            <div class="logo-preview" id="logoPreview" style="background:#fff;">
              <span style="color:#cbd5e1; font-size:0.9rem;">Logo preview</span>
            </div>
          </div>

          <h3 style="margin-top:24px; margin-bottom:12px; color:#0f172a; font-size:0.95rem;">Background Image</h3>
          <div style="margin-bottom:20px;">
            <label for="backgroundImageUpload" style="display:block; margin-bottom:8px; font-weight:600; color:#0f172a;">Upload Background Image</label>
            <input type="file" id="backgroundImageUpload" accept="image/*" style="padding:8px 12px; border:1px solid #cbd5e1; border-radius:6px; width:100%;" />
            <span class="info-text" style="display:block; margin-top:8px;">PNG, JPG, or GIF - max 3.5MB. Automatically compressed to 75% opacity and applied to all pages.</span>
            <div id="backgroundPreview" style="margin-top:12px; width:100%; height:120px; border:2px dashed #cbd5e1; border-radius:6px; background-size:cover; background-position:center; background-color:#f8fafc;"></div>
          </div>

          <h3 style="margin-top:24px; margin-bottom:12px; color:#0f172a; font-size:0.95rem;">Colours</h3>
          <div class="settings-grid">
            <div class="settings-field">
              <label>Banner & Header Color</label>
              <div class="color-input-group">
                <input type="color" id="bannerColor" value="#0078d7" />
                <span id="bannerColorValue" style="font-family:monospace; font-size:0.85rem; color:#64748b;">#0078d7</span>
              </div>
            </div>
            <div class="settings-field">
              <label>Button Color</label>
              <div class="color-input-group">
                <input type="color" id="buttonColor" value="#0078d7" />
                <span id="buttonColorValue" style="font-family:monospace; font-size:0.85rem; color:#64748b;">#0078d7</span>
              </div>
            </div>
            <div class="settings-field">
              <label>Accent Color</label>
              <div class="color-input-group">
                <input type="color" id="accentColor" value="#22c55e" />
                <span id="accentColorValue" style="font-family:monospace; font-size:0.85rem; color:#64748b;">#22c55e</span>
              </div>
            </div>
            <div class="settings-field">
              <label>Tab Color</label>
              <div class="color-input-group">
                <input type="color" id="tabColor" value="#0078d7" />
                <span id="tabColorValue" style="font-family:monospace; font-size:0.85rem; color:#64748b;">#0078d7</span>
              </div>
            </div>
          </div>

          <div style="margin-top:20px; padding:16px; background:#f8fafc; border-radius:6px;">
            <h4 style="margin:0 0 12px; color:#0f172a; font-size:0.9rem;">Preview</h4>
            <div style="display:flex; gap:8px;">
              <button id="previewBanner" style="background:#0078d7; color:#fff; padding:8px 16px; border:none; border-radius:4px; cursor:default; font-weight:600;">Preview Banner</button>
              <button id="previewButton" style="background:#0078d7; color:#fff; padding:8px 16px; border:none; border-radius:4px; cursor:default; font-weight:600;">Preview Button</button>
            </div>
          </div>

          <div class="settings-actions">
            <button class="btn-reset" id="resetThemeBtn">Reset to Default</button>
            <button class="btn-save" id="saveThemeBtn">Save Theme</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add/Edit Cleaner Modal -->
  <div id="cleanerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Add Cleaner</h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      
      <form id="cleanerForm">
        <div class="form-group">
          <label for="cleanerName">Cleaner Name *</label>
          <input type="text" id="cleanerName" required placeholder="e.g., John Smith" />
        </div>
        
        <div class="form-group">
          <label for="cleanerEmail">Email</label>
          <input type="email" id="cleanerEmail" placeholder="cleaner@example.com" />
        </div>
        
        <div class="form-group">
          <label for="cleanerPhone">Phone</label>
          <input type="tel" id="cleanerPhone" placeholder="07XXX XXXXXX" />
        </div>
        
        <div class="form-group">
          <label for="cleanerStatus">Status *</label>
          <select id="cleanerStatus" required>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-reset" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn-save" id="saveCleanerBtn">Save Cleaner</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="./subscriber-settings.js?v=20251123-2"></script>
  <script>
    window.addEventListener('load', () => {
      if (!document.getElementById('mainContent')) {
        console.warn('[Swash] Stale HTML detected, forcing cache-bypass reload');
        setTimeout(() => {
          const url = new URL(window.location.href);
          url.searchParams.set('v','20251123-1');
          window.location.replace(url.toString());
        }, 50);
      }
    });
  </script>
</body>
</html>
