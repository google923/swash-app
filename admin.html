<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <meta name="theme-color" content="#0078d7" />

  <title>Swash Admin Dashboard</title>

  <link rel="manifest" href="./manifest.json" />

  <link rel="icon" href="./assets/favicon-192.png" type="image/png" />

  <link rel="stylesheet" href="./style.css" />

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" defer></script>

</head>

<body>

  <header class="header">

    <div class="header-left">

      <img class="header-logo" src="./assets/swash-logo.png" alt="Swash logo" />
      <a href="/rep/quote.html" class="btn btn-primary" style="margin-left:12px;font-size:14px;padding:8px 14px;">âž• Add Customer</a>
      <label id="repViewToggle" class="rep-view-toggle hidden" style="margin-left:12px;display:inline-flex;align-items:center;gap:6px;">
        <input type="checkbox" id="repViewCheckbox" />
        <span>Rep View</span>
      </label>

    </div>

    <div class="header-actions">
      <button id="logoutBtn" class="btn btn-secondary" type="button" hidden>Sign out</button>
      <div class="menu-box">
        <button id="menuBtn" class="btn btn-secondary" aria-haspopup="true" aria-expanded="false">Menu</button>
        <nav id="menuDropdown" class="dropdown">
          <div class="dropdown-title">Navigation</div>
          <a id="rep-home-link" class="hidden" href="/rep/rep-home.html">Rep Home</a>
          <a id="admin-dashboard-link" class="hidden" href="/admin.html">Admin Dashboard</a>
          <a id="stats-link" class="hidden" href="./admin/stats.html">ðŸ“Š Stats</a>
          <a id="add-customer-link" class="hidden" href="/rep/quote.html">Add Customer</a>
          <a id="schedule-link" class="hidden" href="/rep/scheduler.html">Schedule</a>
          <a id="manage-users-link" class="hidden" href="./admin/users.html">Manage Users</a>
        </nav>
      </div>
    </div>

  </header>

  <section id="authOverlay" class="auth-overlay" aria-live="polite" hidden>
    <form id="loginForm" class="auth-card" novalidate>
      <h2>Sign in</h2>
      <p class="text-muted">Use your Swash admin credentials to continue.</p>
      <label for="loginEmail">Email</label>
      <input id="loginEmail" type="email" autocomplete="email" required />
      <label for="loginPassword">Password</label>
      <input id="loginPassword" type="password" autocomplete="current-password" required />
      <p id="loginError" class="status warning" hidden></p>
      <button type="submit" class="btn btn-primary">Sign in</button>
    </form>
  </section>

  <main id="adminContent" class="page">

    <section class="card">

      <header class="card-header">
        <div class="card-header-main">
          <h2>New customer pipeline</h2>
          <p class="text-muted">Review incoming quotes, confirm bookings, export data, and manage customer status.</p>
        </div>
        <div class="card-header-actions">
          <label for="searchQuotes" class="sr-only">Search quotes</label>
          <input id="searchQuotes" type="search" placeholder="Search quotes..." autocomplete="off" />
        </div>
      </header>



      <div class="summary" role="status" aria-live="polite">

        <div id="summaryTotal">Total &pound;0.00</div>

        <div id="summaryAvg">Avg Price: &pound;0.00</div>

        <div id="summaryUpfront">Avg Upfront: &pound;0.00</div>

        <div id="summaryCount">Count: 0</div>

      </div>



      <section class="controls controls-with-actions" aria-label="Filters and actions">
        <div class="filter-group">
          <div>
            <label class="text-muted" for="startDate">From</label>
            <input id="startDate" type="date" />
          </div>
          <div>
            <label class="text-muted" for="endDate">To</label>
            <input id="endDate" type="date" />
          </div>
          <div>
            <label class="text-muted" for="repFilter">Rep code</label>
            <select id="repFilter">
              <option value="ALL">All reps</option>
              <option value="WEBSITE QUOTE">WEBSITE QUOTE</option>
              <option value="CHRIS">CHRIS</option>
              <option value="JASMINE">JASMINE</option>
              <option value="HARVIE">HARVIE</option>
              <option value="GLEN">GLEN</option>
              <option value="KEVIN">KEVIN</option>
            </select>
          </div>
          <div>
            <label class="text-muted" for="statusFilter">Status</label>
            <select id="statusFilter">
              <option value="ALL">All statuses</option>
            <option value="NEEDS_BOOKING">Needs booking</option>
            <option value="BOOKED">Booked</option>
            <option value="CANCELLED">Cancelled</option>
          </select>
        </div>
        <div class="filter-toggle">
          <label for="showSelectedOnly">
            <input id="showSelectedOnly" type="checkbox" />
            <span>Show selected only</span>
          </label>
        </div>
        <div class="filter-actions">
          <button id="applyFilters" class="btn btn-primary" type="button">Apply</button>
          <button id="clearFilters" class="btn btn-secondary" type="button">Clear</button>
        </div>
      </div>
        <div class="assign-cleaner">
          <label class="text-muted" for="assignCleanerSelect">Assign to cleaner</label>
          <div class="assign-cleaner__controls">
            <select id="assignCleanerSelect"></select>
            <button id="assignCleanerApply" class="btn btn-secondary" type="button">Assign</button>
          </div>
        </div>
      </section>

      <div id="selectedCustomersBox" class="selected-customers-box hidden">
        <div class="selected-customers-content">
          <div id="selectedCustomersList" class="selected-customers-list"></div>
          <div class="actions-group">
            <div class="actions-dropdown">
              <button id="actionsToggle" class="btn btn-success actions-toggle" type="button" aria-haspopup="true" aria-expanded="false">
                Actions
                <span class="actions-toggle__icon" aria-hidden="true">&#9662;</span>
              </button>
              <ul id="actionsMenu" class="actions-menu" role="menu" aria-hidden="true">
                <li role="menuitem"><button type="button" id="sendEmailMenu" data-action="sendEmails">Send booking emails</button></li>
                <li role="menuitem"><button type="button" id="addToScheduleMenu" data-action="schedule">Add to schedule</button></li>
                <li role="menuitem"><button type="button" id="archiveMenu" data-action="archive">Archive selected</button></li>
                <li role="menuitem"><button type="button" id="exportMenu" data-action="export">Export CSV</button></li>
                <li role="menuitem"><button type="button" id="importMenu" data-action="import">Import customers</button></li>
              </ul>
            </div>
          </div>
        </div>
      </div>



      <div class="quotes-view">
        <div class="table-wrapper desktop-only">
          <table id="quotesTable" class="quotes-table" role="table" aria-label="Quotes">
            <thead>
              <tr>
                <th scope="col"><input id="selectAll" type="checkbox" aria-label="Select all" /></th>
                <th scope="col">Rep code</th>
                <th scope="col">Quote date</th>
                <th scope="col">Customer</th>
                <th scope="col">Address</th>
                <th scope="col">Cleaner</th>
                <th scope="col">Contact info</th>
                <th scope="col">Per clean</th>
                <th scope="col">Upfront</th>
              </tr>
            </thead>
            <tbody id="quotesBody">
              <tr><td colspan="9">Loading...</td></tr>
            </tbody>
          </table>
        </div>
        <div id="quotesCards" class="quotes-cards mobile-only" aria-live="polite"></div>
      </div>

      <div class="table-footer" aria-live="polite">
        <span id="paginationInfo" class="pagination-info">Showing 0 results</span>
        <div class="pagination-controls">
          <button id="prevPage" class="btn btn-secondary" type="button">Previous</button>
          <button id="nextPage" class="btn btn-secondary" type="button">Next</button>
        </div>
      </div>

    </section>

  </main>

  <div id="setCustomerLocationModal" class="modal" hidden>
    <div class="modal__dialog modal__dialog--large">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h3 style="margin: 0;">Set Customer Location</h3>
        <button type="button" class="modal__close" id="closeCustomerLocationModal" aria-label="Close">Ã—</button>
      </div>
      <p style="color: #64748b; font-size: 0.95rem; margin-bottom: 12px;">Drag the pin to the exact customer location. Address: <strong id="customerLocationAddressDisplay"></strong></p>
      <div id="customerLocationMap" style="width: 100%; height: 400px; border-radius: 8px; border: 2px solid #e5e7eb; margin-bottom: 16px;"></div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
        <label class="modal__field">
          <span>Latitude</span>
          <input id="customerLocationLatInput" type="number" placeholder="Latitude" step="0.0001" />
        </label>
        <label class="modal__field">
          <span>Longitude</span>
          <input id="customerLocationLngInput" type="number" placeholder="Longitude" step="0.0001" />
        </label>
      </div>
      <div class="modal__actions">
        <button type="button" class="btn btn-secondary" id="cancelCustomerLocationBtn">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveCustomerLocationBtn">Save Location</button>
      </div>
    </div>
  </div>

  <div id="importModal" class="modal" hidden>
    <div class="modal__dialog">
      <h3>Import Customers</h3>
      <p>Upload a CSV file with customer details to add them to the dashboard.</p>
      <label class="modal__field">
        <span>CSV file</span>
        <input id="importFile" type="file" accept=".csv" />
      </label>
      <p id="importStatus" class="modal__progress" aria-live="polite"></p>
      <div class="modal__actions">
        <button type="button" class="btn btn-secondary" id="importCancel">Cancel</button>
        <button type="button" class="btn btn-success" id="importConfirm">Import</button>
      </div>
    </div>
  </div>

  <div id="scheduleModal" class="modal" hidden>
    <div class="modal__dialog">
      <div class="modal__title-row">
        <h3>Schedule customers for</h3>
        <div class="modal__title-control">
          <label class="sr-only" for="scheduleCleanerSelect">Cleaner</label>
          <select id="scheduleCleanerSelect" class="modal-cleaner-select"></select>
        </div>
      </div>
      <p>When would you like to book the first cleans for?</p>
      <ul id="scheduleCustomerList" class="modal__list" aria-live="polite"></ul>
      <label class="modal__field">
        <span>First clean date</span>
        <input id="scheduleDate" type="date" />
      </label>
      <p id="scheduleStatus" class="modal__progress" aria-live="polite"></p>
      <div class="modal__actions">
        <button type="button" class="btn btn-secondary" id="scheduleCancel">Cancel</button>
        <button type="button" class="btn btn-success" id="scheduleConfirm">Add to schedule</button>
      </div>
    </div>
  </div>



  <section id="popupModal" aria-hidden="true">

    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="emailModalTitle">

      <header class="modal__header">
        <div class="modal__title-group">
          <h3 id="emailModalTitle">Send booking confirmations for</h3>
          <div class="modal__title-control">
            <label class="sr-only" for="emailCleanerSelect">Cleaner</label>
            <select id="emailCleanerSelect" class="modal-cleaner-select"></select>
          </div>
        </div>
        <button id="closeModal" class="btn btn-secondary" type="button">Close</button>
      </header>

      <div id="selectedRecipients" class="selected-customers"></div>

      <div class="modal-date-row">

        <label class="text-muted" for="cleanDate">First clean date</label>

        <input id="cleanDate" type="date" />

        <button id="refreshPreview" class="btn btn-secondary" type="button">Add booking date</button>

      </div>

      <div class="preview-tabs">

        <button class="tab-btn active" data-tab="desktop" type="button">Desktop preview</button>

        <button class="tab-btn" data-tab="mobile" type="button">Mobile preview</button>

      </div>

      <article id="emailPreview" class="email-preview-pane"></article>

      <footer style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:16px;">
        <span id="sendProgress" style="font-weight:700;color:#0078d7;visibility:hidden;">0 of 0 sent</span>
        <div style="display:flex;gap:12px;">
          <button id="confirmSend" class="btn btn-primary" type="button">Send emails</button>
          <button id="closeModalSecondary" class="btn btn-secondary" type="button">Cancel</button>
        </div>
      </footer>

    </div>

  </section>



  <script type="module" src="./firebase-init.js"></script>
  <script type="module" src="./auth-check.js"></script>
  <script type="module" src="./nav.js"></script>
  <script type="module" src="./admin.js"></script>

  <!-- Google Maps API -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcI3UKTFSa-J3t3C3eebXr5tpDFqIznpI&libraries=geometry,drawing,places"></script>

</body>

</html>

